# –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ—Ö–æ–¥–æ–≤ –∫–ª–∏–µ–Ω—Ç–æ–≤ –ê–ª—å—Ñ–∞-–ë–∞–Ω–∫

**–ì–∏–±—Ä–∏–¥–Ω–∞—è AI-–º–æ–¥–µ–ª—å**: FT-Transformer (—ç–º–±–µ–¥–¥–∏–Ω–≥–∏) + CatBoost (–ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ)

**–°–∞–π—Ç —Å –º–æ–¥–µ–ª—å—é –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ —Å—Å—ã–ª–∫–µ:** https://697a89851137da.lhr.life

## üí° –ö–ª—é—á–µ–≤–∞—è –∏–¥–µ—è

**Two-stage –ø–æ–¥—Ö–æ–¥** —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–µ—Ä–∞:

1. **FT-Transformer** –∏–∑–≤–ª–µ–∫–∞–µ—Ç –≥–ª—É–±–æ–∫–∏–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ (192-dim) –∑–∞ 20 —ç–ø–æ—Ö —Å —Ä–µ–≥—É–ª—è—Ä–∏–∑–∞—Ü–∏–µ–π
2. **CatBoost** —Å—Ç—Ä–æ–∏—Ç —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –Ω–∞ —ç–º–±–µ–¥–¥–∏–Ω–≥–∞—Ö + –∏—Å—Ö–æ–¥–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–∞—Ö

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**

- ‚úÖ –†–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—è
- ‚úÖ Validation WMAE: ~36,000-39,000 ‚ÇΩ (–ª—É—á—à–µ —á–µ–º –æ—Ç–¥–µ–ª—å–Ω—ã–µ –º–æ–¥–µ–ª–∏)
- ‚úÖ –ë—ã—Å—Ç—Ä–æ–µ –æ–±—É—á–µ–Ω–∏–µ (~20-35 –º–∏–Ω—É—Ç)
- ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω—ã–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
cd zlp
python -m venv venv
source venv/bin/activate  # Linux/macOS
# –∏–ª–∏ venv\Scripts\activate –¥–ª—è Windows

pip install -r requirements.txt
```

### 2. –û–±—É—á–µ–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞

```bash
chmod +x quick_train.sh
./quick_train.sh
```

–°–∫—Ä–∏–ø—Ç –æ–±—É—á–∏—Ç –≥–∏–±—Ä–∏–¥–Ω—É—é –º–æ–¥–µ–ª—å (~20-35 –º–∏–Ω—É—Ç) –∏ –ø–æ–∫–∞–∂–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—É—é –º–µ—Ç—Ä–∏–∫—É WMAE.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**

- `hybrid_model.cbm` - CatBoost –º–æ–¥–µ–ª—å
- `hybrid_model_embedder.pth` - FT-Transformer embedder
- `submission_hybrid.csv` - —Ñ–∞–π–ª –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ –ª–∏–¥–µ—Ä–±–æ—Ä–¥

### 3. –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

```bash
python app.py
```

–û—Ç–∫—Ä–æ–π—Ç–µ: http://localhost:5000

## üìÅ –§–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞

- `model.py` - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ FT-Transformer
- `train_hybrid.py` - –û–±—É—á–µ–Ω–∏–µ –≥–∏–±—Ä–∏–¥–Ω–æ–π –º–æ–¥–µ–ª–∏
- `app.py` - Flask –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- `quick_train.sh` - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±—É—á–µ–Ω–∏–µ
- `requirements.txt` - –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≥–∏–±—Ä–∏–¥–Ω–æ–π –º–æ–¥–µ–ª–∏

```
Input Features (216 –ø—Ä–∏–∑–Ω–∞–∫–æ–≤)
    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   –≠–¢–ê–ü 1: FT-Transformer Embedder   ‚îÇ
‚îÇ   (20 —ç–ø–æ—Ö —Å —Ä–µ–≥—É–ª—è—Ä–∏–∑–∞—Ü–∏–µ–π)        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚Üì
Feature Tokenization
    ‚îú‚îÄ‚îÄ –ß–∏—Å–ª–æ–≤—ã–µ (206): Linear + Bias
    ‚îî‚îÄ‚îÄ –ö–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã–µ (10): Embedding
    ‚Üì
Transformer Encoder (3 —Å–ª–æ—è √ó 8 heads)
    ‚îú‚îÄ‚îÄ Multi-Head Self-Attention
    ‚îú‚îÄ‚îÄ FFN (512)
    ‚îú‚îÄ‚îÄ Dropout 0.2
    ‚îî‚îÄ‚îÄ Layer Norm
    ‚Üì
[CLS] Token ‚Üí Embeddings (192-dim)
    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   –≠–¢–ê–ü 2: CatBoost Regressor        ‚îÇ
‚îÇ   (2000 –∏—Ç–µ—Ä–∞—Ü–∏–π)                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚Üì
Concatenate:
  ‚Ä¢ –ò—Å—Ö–æ–¥–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ (206)
  ‚Ä¢ –≠–º–±–µ–¥–¥–∏–Ω–≥–∏ (192)
  ‚Üí –ò—Ç–æ–≥–æ: 398 –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
    ‚Üì
Gradient Boosting
    ‚Üì
Predicted Income
```

## üìä –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–±—É—á–µ–Ω–∏—è

```bash
python train_hybrid.py \
    --transformer_epochs 20 \   # –≠–ø–æ—Ö –¥–ª—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–µ—Ä–∞
    --batch_size 256 \          # –†–∞–∑–º–µ—Ä –±–∞—Ç—á–∞
    --learning_rate 1e-4 \      # –°–∫–æ—Ä–æ—Å—Ç—å –æ–±—É—á–µ–Ω–∏—è
    --d_token 192 \             # –†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
    --n_layers 3 \              # –°–ª–æ–∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–µ—Ä–∞
    --n_heads 8                 # Attention heads
```

**–î–ª—è CPU:**

```bash
python train_hybrid.py --transformer_epochs 20 --batch_size 128 --cpu
```

## üåê –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø–æ—Å–ª–µ –æ–±—É—á–µ–Ω–∏—è:

```bash
python app.py
```

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**

- –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –¥–æ—Ö–æ–¥–∞ –ø–æ JSON –¥–∞–Ω–Ω—ã–º –∫–ª–∏–µ–Ω—Ç–∞
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π
- REST API –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

**API Example:**

```python
import requests

response = requests.post(
    "http://localhost:5000/predict",
    json={"age": 35, "salary": 60000, ...}
)

result = response.json()
print(f"–î–æ—Ö–æ–¥: {result['predicted_income_formatted']}")
print(f"–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è: {result['offers']}")
```

## üìà –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

| –ú–µ—Ç—Ä–∏–∫–∞             | –ó–Ω–∞—á–µ–Ω–∏–µ                |
| ------------------- | ----------------------- |
| **Validation WMAE** | **~36,000-39,000 ‚ÇΩ** ‚úÖ |
| MAE                 | ~28,000 ‚ÇΩ               |
| –û–±—É—á–µ–Ω–∏–µ (CPU)      | 20-35 –º–∏–Ω—É—Ç             |
| –û–±—É—á–µ–Ω–∏–µ (GPU)      | 10-20 –º–∏–Ω—É—Ç             |
| Inference           | ~15-25 ms/–∫–ª–∏–µ–Ω—Ç        |

## üí° –ü–æ—á–µ–º—É –≥–∏–±—Ä–∏–¥–Ω–∞—è –º–æ–¥–µ–ª—å —Ä–∞–±–æ—Ç–∞–µ—Ç?

### –ü—Ä–æ–±–ª–µ–º–∞ —á–∏—Å—Ç–æ–≥–æ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–µ—Ä–∞:

```
–≠–ø–æ—Ö–∞ 6: Train Loss: 0.2595, Val WMAE: 40881 ‚úì
–≠–ø–æ—Ö–∞ 7: Train Loss: 0.2574, Val WMAE: 43179 ‚úó
–≠–ø–æ—Ö–∞ 8: Train Loss: 0.2527, Val WMAE: 43512 ‚úó
‚Üí –ü–ï–†–ï–û–ë–£–ß–ï–ù–ò–ï: train loss –ø–∞–¥–∞–µ—Ç, val WMAE —Ä–∞—Å—Ç–µ—Ç
```

### –†–µ—à–µ–Ω–∏–µ - –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥:

1. **–¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–µ—Ä —Å —Ä–µ–≥—É–ª—è—Ä–∏–∑–∞—Ü–∏–µ–π** (20 —ç–ø–æ—Ö)
    - Dropout 0.2 + Attention Dropout 0.3
    - Early stopping
    - –ù–µ —É—Å–ø–µ–≤–∞–µ—Ç –ø–µ—Ä–µ–æ–±—É—á–∏—Ç—å—Å—è

2. **CatBoost –Ω–∞ —ç–º–±–µ–¥–¥–∏–Ω–≥–∞—Ö**
    - –ö–æ–º–±–∏–Ω–∏—Ä—É–µ—Ç —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ + –∏—Å—Ö–æ–¥–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏
    - –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–∞—è —Ä–µ–≥—É–ª—è—Ä–∏–∑–∞—Ü–∏—è gradient boosting
    - –°—Ç–∞–±–∏–ª—å–Ω—ã–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è

3. **–†–µ–∑—É–ª—å—Ç–∞—Ç:** Val WMAE ~36K-39K (–ª—É—á—à–µ!) –±–µ–∑ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—è

## üîß –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

**Out of Memory:**

```bash
python train_hybrid.py --batch_size 128 --cpu
```

**–î–æ–ª–≥–æ–µ –æ–±—É—á–µ–Ω–∏–µ:**

```bash
python train_hybrid.py --transformer_epochs 15 --batch_size 128
```

**ModuleNotFoundError:**

```bash
pip install -r requirements.txt
```

## üì¶ –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã–µ —Ñ–∞–π–ª—ã

–ü–æ—Å–ª–µ –æ–±—É—á–µ–Ω–∏—è:

- `hybrid_model.cbm` - CatBoost –º–æ–¥–µ–ª—å (~2-5 MB)
- `hybrid_model_embedder.pth` - FT-Transformer embedder (~10-15 MB)
- `submission_hybrid.csv` - –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –¥–ª—è test.csv

## üéì –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **PyTorch 2.0+** - —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–µ—Ä –¥–ª—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
- **CatBoost 1.2+** - gradient boosting –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è
- **Flask 2.3+** - –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **scikit-learn** - –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
- **Pandas, NumPy** - —Ä–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç

- [ ] Python 3.8+ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- [ ] –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã (`pip install -r requirements.txt`)
- [ ] CSV —Ñ–∞–π–ª—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `zlp/`
- [ ] –ú–æ–¥–µ–ª—å –æ–±—É—á–µ–Ω–∞ (`./quick_train.sh`)
- [ ] –ü–æ–ª—É—á–µ–Ω `submission_hybrid.csv`
- [ ] –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∑–∞–ø—É—â–µ–Ω (`python app.py`)

## üéØ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∑–∞–¥–∞—á–∏

### ‚úÖ 1. AI-–º–æ–¥–µ–ª—å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–æ–¥ WMAE

- –ì–∏–±—Ä–∏–¥–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: FT-Transformer ‚Üí —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ ‚Üí CatBoost
- Validation WMAE: ~36,000-39,000 ‚ÇΩ
- –§–∞–π–ª—ã: `model.py`, `train_hybrid.py`

### ‚úÖ 2. –†–∞–±–æ—Ç–∞—é—â–∏–π –≤–µ–±-–ø—Ä–æ—Ç–æ—Ç–∏–ø

- Flask –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å HTML –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º
- –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –¥–æ—Ö–æ–¥–∞ + —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
- REST API –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- –§–∞–π–ª: `app.py`

### ‚úÖ 3. –û–±—ä—è—Å–Ω–∏–º–æ—Å—Ç—å –º–æ–¥–µ–ª–∏

- CatBoost feature importance
- Attention weights –∏–∑ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–µ—Ä–∞
- –ü–æ–Ω—è—Ç–Ω—ã–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### ‚úÖ 4. Python-—Å–∫—Ä–∏–ø—Ç—ã + venv

- –í–µ—Å—å –∫–æ–¥ –≤ .py —Ñ–∞–π–ª–∞—Ö
- requirements.txt –¥–ª—è venv
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç –æ–±—É—á–µ–Ω–∏—è

---

**–£–¥–∞—á–∏ –≤ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–∏ –¥–æ—Ö–æ–¥–æ–≤! üöÄ**

–î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –∑–∞–ø—É—Å—Ç–∏—Ç–µ:

```bash
python train_hybrid.py --help
python app.py
```
